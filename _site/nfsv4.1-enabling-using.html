<!DOCTYPE html>
<html lang="en">
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="This topic explains how you can configure your cluster for a supported export configuration and enable or disable NFSv4.1 on your cluster.">
<meta name="keywords" content=" nfs, nfs3, nfsv3, nfsv4.1, exports, mount, cluster, enable nfs, disable nfs, floating ip">
<title>Enabling and Using NFSv4.1 on a Qumulo Cluster  | Qumulo Documentation</title>


<link rel="stylesheet" href="http://localhost:4010/qumulo-doc/css/syntax.css">
<link rel="stylesheet" href="http://localhost:4010/qumulo-doc/css/font-awesome.min.css">
<link rel="stylesheet" href="http://localhost:4010/qumulo-doc/css/bootstrap.min.css">
<link rel="stylesheet" href="http://localhost:4010/qumulo-doc/css/modern-business.css">
<link rel="stylesheet" href="http://localhost:4010/qumulo-doc/css/customstyles.css">
<link rel="stylesheet" href="http://localhost:4010/qumulo-doc/css/theme-blue.css">
<link rel="stylesheet" href="http://localhost:4010/qumulo-doc/css/syntax.css">
<link rel="stylesheet" href="/qumulo-doc/css/printstyles.css">

<script>
    Prince.addScriptFunc("datestamp", function() {
        return "PDF last generated: December 10, 2021";
    });
</script>

<script>
    Prince.addScriptFunc("guideName", function() {
        return "Qumulo on Supermicro A+ WIO 1114S-WN10RT Getting Started Guide User Guide";
    });
</script>



</head>

<body class=" print">

<!-- Page Content -->
<div class="container">
    <!-- Content Column -->
    <div class="col-md-9">

        <div class="post-header">
    <h1 class="post-title-main" id="nfsv4.1-enabling-using.html">Enabling and Using NFSv4.1 on a Qumulo Cluster</h1>
</div>

<div class="post-content">

    
    <div class="summary">This topic explains how you can configure your cluster for a supported export configuration and enable or disable NFSv4.1 on your cluster.</div>
    
    <p>Qumulo Core 4.3.0 (and higher) supports Network File System version 4.1 (NFSv4.1). This section explains how you can configure your cluster for a supported export configuration and enable or disable NFSv4.1 on your cluster. It also provides detail about supported and unsupported features. For more information about NFSv4.1 and file access permissions, see <a href="/qumulo-doc/nfsv4.1-auth-sys-acls.html">Managing File Access Permissions Using NFSv4.1 Access Control Lists (ACLs)</a>.</p>

<div class="alert alert-warning" role="alert"><i class="fa fa-warning"></i> <b>Important</b><br /> Currently, Qumulo Core supports only NFSv4.1. Mounting with version 4.0 or 4.2 isn’t supported.</div>

<h2 id="configuring-and-using-exports-for-nfsv41">Configuring and Using Exports for NFSv4.1</h2>
<p>Qumulo’s NFS exports can present a view of your cluster over NFS that might differ from the contents of the underlying file system. You can mark NFS exports as read-only, restricted (to allow access only from certain IP adresses), or configure specific user mappings. For more information, see <a href="https://care.qumulo.com/hc/en-us/articles/360000723928-Create-an-NFS-Export">Create an NFS Export</a> in Qumulo Care.</p>

<p>While NFSv3 and NFSv4.1 share each cluster’s NFS export configuration, exports behave differently when you access them using NFSv4.1. This section explains these differences and the new requirements for export configurations with NFSv4.1.</p>

<h3 id="differences-between-nfsv3-and-nfsv41-exports">Differences Between NFSv3 and NFSv4.1 Exports</h3>
<p>In the following example, a Qumulo cluster has the following export configuration.</p>

<table>
  <thead>
    <tr>
      <th>Export Name</th>
      <th>File System Path</th>
      <th>Read-Only</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/home</code></td>
      <td><code class="language-plaintext highlighter-rouge">/home</code></td>
      <td>No</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/files</code></td>
      <td><code class="language-plaintext highlighter-rouge">/home/admin/files</code></td>
      <td>No</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/read_only/home</code></td>
      <td><code class="language-plaintext highlighter-rouge">/home</code></td>
      <td>Yes</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/read_only/files</code></td>
      <td><code class="language-plaintext highlighter-rouge">/home/admin/files</code></td>
      <td>Yes</td>
    </tr>
  </tbody>
</table>

<p>NFSv3 lets you mount one of these exports by specifying the full export name, for example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mount <span class="nt">-onfsvers</span><span class="o">=</span>3 cluster.qumulo.com:/read_only/home /mnt/cluster/home
</code></pre></div></div>

<p>This command gives read-only access to the <code class="language-plaintext highlighter-rouge">/home</code> directory on the cluster using the path <code class="language-plaintext highlighter-rouge">/mnt/cluster/home</code>. However, the following command fails with the <code class="language-plaintext highlighter-rouge">No such file or directory</code> message.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mount <span class="nt">-onfsvers</span><span class="o">=</span>3 cluster.qumulo.com:/read_only /mnt/cluster/read_only
</code></pre></div></div>

<p>NFSv4.1 still lets you mount exports by specifying the full export name. However, NFSv4.1 also supports navigating <em>above</em> exports, as if they are part of the file system. The following command succeeds.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mount <span class="nt">-onfsvers</span><span class="o">=</span>4.1 cluster.qumulo.com:/read_only /mnt/cluster/read_only
</code></pre></div></div>

<p>At the mount, the exports under <code class="language-plaintext highlighter-rouge">/read_only</code> are visible: <code class="language-plaintext highlighter-rouge">/mnt/cluster/read_only</code> displays virtual directories named <code class="language-plaintext highlighter-rouge">files/</code> and <code class="language-plaintext highlighter-rouge">home/</code> with the contents of the corresponding directories in the file system, for example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/mnt/cluster/read_only/
|--- files/&lt;file system contents&gt;
|--- home/
|------ admin/files/&lt;file system contents&gt;
|------ &lt;other file system contents&gt;
</code></pre></div></div>

<p>This presentation of exports lets you view existing exports using the file system’s own interface. It also lets you view new exports as soon as someone creates or modifies them without remounting.</p>

<h3 id="preparing-export-configurations-for-nfsv41">Preparing Export Configurations for NFSv4.1</h3>
<p>Qumulo’s implementation of NFSv4.1 distinguishes between navigating <em>above</em> exports and <em>inside</em> an export. To avoid confusion between paths that refer to a virtual directory above an export or a real file system directory inside an export, no export name can be a prefix of another export name when NFSv4.1 is enabled.</p>

<p>In the following example, a Qumulo cluster has the following export configuration.</p>

<table>
  <thead>
    <tr>
      <th>Export Name</th>
      <th>File System Path</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/</code></td>
      <td><code class="language-plaintext highlighter-rouge">/</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/admin</code></td>
      <td><code class="language-plaintext highlighter-rouge">/home/admin</code></td>
    </tr>
  </tbody>
</table>

<p>Because <code class="language-plaintext highlighter-rouge">/</code> is a prefix of <code class="language-plaintext highlighter-rouge">/admin</code>, you can’t enable NFSv4.1 with this export configuration. This restriction prevents the situation where the path <code class="language-plaintext highlighter-rouge">/admin</code> can refer to both the export of <code class="language-plaintext highlighter-rouge">/home/admin</code> or the actual file system path <code class="language-plaintext highlighter-rouge">/admin</code>.</p>

<p>To prepare this configuration for NFSv4.1, you can do one of the following:</p>
<ul>
  <li>Delete the <code class="language-plaintext highlighter-rouge">/</code> export and use NFSv4.1 presentation of exports when mounting <code class="language-plaintext highlighter-rouge">/</code>.</li>
  <li>Delete the <code class="language-plaintext highlighter-rouge">/admin</code> export.</li>
  <li>Give the <code class="language-plaintext highlighter-rouge">/</code> export a name that doesn’t use other exports as a prefix, for example:</li>
</ul>

<table>
  <thead>
    <tr>
      <th>Export Name</th>
      <th>File System Path</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/root</code></td>
      <td><code class="language-plaintext highlighter-rouge">/</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/admin</code></td>
      <td><code class="language-plaintext highlighter-rouge">/home/admin</code></td>
    </tr>
  </tbody>
</table>

<h3 id="visibility-of-ip-restricted-exports">Visibility of IP-Restricted Exports</h3>
<div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note</b><br /> The names of exports are public to all NFSv4.1 clients, regardless of IP restrictions. You can’t disable this behavior.</div>

<p>NFSv4.1 respects IP restrictions on exports: only clients with allowed IP addresses can access the contents of an export. However, clients without access to an export can still view the export as a directory when they traverse <em>above</em> exports. The restrictions apply only when a client attempts to access the contents of the export.</p>

<h3 id="32-bit-sanitization">32-Bit Sanitization</h3>
<ul>
  <li>In NFSv3, you can configure specific exports to return 32-bit sanitized data for individual fields. NFSv3 converts any data larger than 32 bits in configured fields to 32-bit data and returns the data. For example, it can sanitize file size to 32-bit format. This truncates the field to <code class="language-plaintext highlighter-rouge">max_uint32</code> whenever the NFSv3 server returns the attribute.</li>
  <li>NFSv4.1 doesn’t support 32-bit sanitization and ignores any sanitizations configured for an export.</li>
</ul>

<h2 id="using-unique-hostnames-for-nfs-clients">Using Unique Hostnames for NFS Clients</h2>
<p>The NFSv4.1 protocol requires clients to provide the server with globally unique identifiers. However, the NFSv4.1 client for Linux uses the machine’s hostname by default. Because the Linux client doesn’t support using the same hostname to connect to an NFSv4.1 server, an unpredictable failure can occur. We recommend configuring all NFS clients to use unique hostnames. For more information, see <a href="https://www.kernel.org/doc/html/latest/admin-guide/nfs/nfs-client.html">NFS Client</a> in the Linux Kernel User’s and Administrator’s Guide.</p>

<h2 id="enabling-nfsv41-on-a-qumulo-cluster">Enabling NFSv4.1 on a Qumulo Cluster</h2>
<div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note</b><br /> Currently, you can enable NFSv4.1 only using the CLI.</div>

<p>You can enable NFSv4.1 on your Qumulo cluster using a single cluster-wide configuration command, for example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>qq nfs_modify_settings <span class="nt">--enable-v4</span>
</code></pre></div></div>

<p>When you enable NFSv4.1, all NFS exports are accessible using NFSv3 and NFSv4.1.</p>

<h2 id="specifying-the-nfs-mount-option">Specifying the NFS Mount Option</h2>
<p>Typically, NFS clients find and use the highest version of the protocol that both the client and server support. For example, the following command mounts using NFSv4.1 (if it is enabled) and using NFSv3 otherwise:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mount <span class="nt">-t</span> nfs your.qumulo.cluster:/mount_path /path/to/mountpoint
</code></pre></div></div>

<p>Because Qumulo’s NFSv4.1 implementation currently doesn’t have full feature parity with NFSv3, you must provide the <code class="language-plaintext highlighter-rouge">nfsvers=3</code> option for any mounts that require features (such as snapshot access) that only NFSv3 supports, for example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mount <span class="nt">-t</span> nfs <span class="nt">-o</span> <span class="nv">nfsvers</span><span class="o">=</span>3 your.qumulo.cluster:/mount_path /path/to/mountpoint
</code></pre></div></div>

<div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note</b><br /> We recommend specifying the <code class="language-plaintext highlighter-rouge">nfsvers=4</code> or <code class="language-plaintext highlighter-rouge">nfsvers=4.1</code> option for any mounts that use NFSv4.1.</div>

<h2 id="checking-whether-nfsv41-is-enabled">Checking Whether NFSv4.1 is enabled</h2>
<p>To check whether NFSv4.1 is enabled on your cluster, use the following CLI command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>qq nfs_get_settings
</code></pre></div></div>

<h2 id="disabling-nfsv41-on-a-qumulo-cluster">Disabling NFSv4.1 on a Qumulo Cluster</h2>
<div class="alert alert-warning" role="alert"><i class="fa fa-warning"></i> <b>Important</b><br /> Disabling NFSv4.1 makes any NFSv4.1 mounts unusable immediately. We recommend switching any NFSv4.1 mounts to NFSv3 before disabling NFSv4.1.</div>

<p>To disable NFSv4.1 on an entire Qumulo cluster, use the following CLI command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>qq nfs_modify_settings <span class="nt">--disable-v4</span>
</code></pre></div></div>

<h2 id="configuring-floating-ips-for-nodes">Configuring Floating IPs for Nodes</h2>
<p>Currently, each Qumulo node is limited to 1,000 clients connected using NFSv4.1 simultaneously. To account for nodes going down, we recommend balancing the number of client connections across your nodes by configuring a sufficient number of floating IP addresses per node. This prevents a node failover event from overloading the nodes to which the clients might fail over.</p>

<p>For example, if you configure only one IP address per node, on a cluster with 600 clients per node a single node failure might overload one of the remaining nodes, preventing 200 clients from connecting. If you assign multiple floating IP addresses to each node, the clients’ connections are distributed across multiple nodes.</p>

<h2 id="supported-and-unsupported-features-in-qumulos-implementation-of-nfsv41">Supported and Unsupported Features in Qumulo’s Implementation of NFSv4.1</h2>
<p>Qumulo’s implementation of NFSv4.1 currently supports:</p>
<ul>
  <li>General file system access (reading, writing, and navigating files)</li>
  <li>Unstable writes</li>
  <li>Full use of the NFS exports configuration shared with NFSv3</li>
  <li>Navigation in the pseudo-file system above your exports</li>
  <li>NFSv3-style <code class="language-plaintext highlighter-rouge">AUTH_SYS</code> or <code class="language-plaintext highlighter-rouge">AUTH_UNIX</code> authentication</li>
  <li>Fine-grained control over file permissions using access control lists (ACLs)</li>
</ul>

<p>Qumulo Core doesn’t support the following NFSv3 features through NFSv4.1:</p>
<ul>
  <li>Quota sizes don’t appear through NFSv4.1 with certain commands, such as <code class="language-plaintext highlighter-rouge">df</code> (however, Qumulo Core respects directory quotas)</li>
  <li>You can’t access snapshots through NFSv4.1</li>
  <li>File locking (for example, using the <code class="language-plaintext highlighter-rouge">fcntl</code> command)</li>
</ul>

<p>Qumulo Core doesn’t currently support the following NFSv4.1 features:</p>
<ul>
  <li>Secure authentication using Kerberos</li>
  <li>Delegations</li>
</ul>

</div>

    </div>

</div>    <!-- /.container -->

</body>

</html>
