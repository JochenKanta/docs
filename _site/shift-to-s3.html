<!DOCTYPE html>
<html lang="en">
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="This topic explains how you can use Qumulo Shift-To to copy objects from a directory in a Qumulo cluster to a folder in an Amazon Simple Storage Service (Ama...">
<meta name="keywords" content=" shift to, copy, copy objects, copy files, object copy, amazon s3, s3, iam permissions, iam, cli commands, cli, shift relationships, shift, relationships, configuration details, status">
<title>Using Qumulo Shift-To to Copy Objects to Amazon S3  | Qumulo Documentation</title>


<link rel="stylesheet" href="http://10.116.10.222:4010/qumulo-doc/css/syntax.css">
<link rel="stylesheet" href="http://10.116.10.222:4010/qumulo-doc/css/font-awesome.min.css">
<link rel="stylesheet" href="http://10.116.10.222:4010/qumulo-doc/css/bootstrap.min.css">
<link rel="stylesheet" href="http://10.116.10.222:4010/qumulo-doc/css/modern-business.css">
<link rel="stylesheet" href="http://10.116.10.222:4010/qumulo-doc/css/customstyles.css">
<link rel="stylesheet" href="http://10.116.10.222:4010/qumulo-doc/css/theme-blue.css">
<link rel="stylesheet" href="http://10.116.10.222:4010/qumulo-doc/css/syntax.css">
<link rel="stylesheet" href="/qumulo-doc/css/printstyles.css">

<script>
    Prince.addScriptFunc("datestamp", function() {
        return "PDF last generated: January 06, 2022";
    });
</script>

<script>
    Prince.addScriptFunc("guideName", function() {
        return "Qumulo Documentation User Guide";
    });
</script>



</head>

<body class=" print">

<!-- Page Content -->
<div class="container">
    <!-- Content Column -->
    <div class="col-md-9">

        <div class="post-header">
    <h1 class="post-title-main" id="shift-to-s3.html">Using Qumulo Shift-To to Copy Objects to Amazon S3</h1>
</div>

<div class="post-content">

    
    <div class="summary">This topic explains how you can use Qumulo Shift-To to copy objects from a directory in a Qumulo cluster to a folder in an Amazon Simple Storage Service (Amazon S3) bucket.</div>
    
    <p>This section explains how you can use Qumulo Shift-To to copy objects from a directory in a Qumulo cluster to a folder in an Amazon Simple Storage Service (Amazon S3) bucket (cloud object store). For more information about copying objects from S3 to Qumulo, see <a href="/qumulo-doc/shift-from-s3.html">Using Qumulo Shift-From for Amazon S3 to Copy Objects</a>.</p>

<p>The guide describes how a Shift-To relationship works and includes information about the prerequisites, IAM permissions, and CLI commands that you can use to copy files and manage Shift relationships.</p>

<h2 id="prerequisites">Prerequisites</h2>
<ul>
  <li>
    <p>A Qumulo cluster with:</p>

    <ul>
      <li>
        <p>Qumulo Core 3.2.1 (and higher) for the CLI and 3.2.5 (and higher) for the Web UI</p>
      </li>
      <li>
        <p>HTTPS connectivity to <code class="language-plaintext highlighter-rouge">s3.&lt;region&gt;.amazonaws.com</code> though one of the following means:</p>

        <ul>
          <li>
            <p>Public Internet</p>
          </li>
          <li>
            <p><a href="https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints.html">VPC endpoint</a></p>
          </li>
          <li>
            <p><a href="https://docs.aws.amazon.com/whitepapers/latest/aws-vpc-connectivity-options/aws-direct-connect.html">AWS Direct Connect</a></p>
          </li>
        </ul>

        <p>For more information, see <a href="https://docs.aws.amazon.com/general/latest/gr/aws-ip-ranges.html">AWS IP address ranges</a> in the AWS General Reference.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Membership in a Qumulo role with the following privileges:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">PRIVILEGE_REPLICATION_OBJECT_WRITE</code>: This privilege is required to create a Shift relationship.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">PRIVILEGE_REPLICATION_OBJECT_READ</code>: This privilege is required to view the status of a Shift relationship.</p>
      </li>
    </ul>

    <div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note</b><br />
<ul>
  <li>For any changes to take effect, user accounts with newly assigned roles must log out and log back in (or their sessions must time out).</li>
  <li>Use special care when granting privileges to roles and users because certain privileges (such as replication-write privileges) can use system privileges to overwrite or move data to a location where a user has greater permissions. This can give a user access to all directories and files in a cluster regardless of any specific file and directory settings.</li>
</ul>
</div>
  </li>
  <li>
    <p>An existing bucket with contents in Amazon S3</p>
  </li>
  <li>
    <p>AWS credentials (access key ID and secret access key) with the following permissions:</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">s3:AbortMultipartUpload</code></p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">s3:GetObject</code></p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">s3:PutObject</code></p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">s3:ListBucket</code></p>
      </li>
    </ul>

    <p>For more information, see <a href="https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html">Understanding and getting your AWS credentials</a> in the AWS General Reference</p>
  </li>
</ul>

<h3 id="example-iam-policy">Example IAM Policy</h3>
<p>In the following example, the IAM policy gives permission to read from and write to the <code class="language-plaintext highlighter-rouge">my-folder</code> folder in the <code class="language-plaintext highlighter-rouge">my-bucket</code>. This policy can give users the permissions required to run Shift-To jobs.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"s3:ListBucket"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:s3:::my-bucket"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"s3:AbortMultipartUpload"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"s3:GetObject"</span><span class="p">,</span><span class="w"> 
        </span><span class="s2">"s3:PutObject"</span><span class="w">
      </span><span class="p">]</span><span class="w">
      </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:s3:::my-bucket/my-folder/*"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="how-shift-to-relationships-work">How Shift-To Relationships Work</h2>
<p>Qumulo Core performs the following steps when it creates a Shift-To relationship.</p>

<ol>
  <li>
    <p>Verifies that the directory exists on the Qumulo cluster and that the specified S3 bucket exists, is accessible using the specified credentials, and contains downloadable objects.</p>
  </li>
  <li>
    <p>Creates the Shift-To relationship.</p>
  </li>
  <li>
    <p>Starts a job using one of the nodes in the Qumulo cluster.</p>

    <div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note</b><br /> If you perform multiple Shift operations, Qumulo Core uses multiple nodes.</div>
  </li>
  <li>
    <p>To ensure that the copy is point-in-time consistent, takes a temporary snapshot of the directory (for example, named <code class="language-plaintext highlighter-rouge">replication_to_bucket_my_bucket</code>).</p>
  </li>
  <li>
    <p>Recursively traverses the directories and files in the snapshots and copies each object to a corresponding object in S3.</p>
  </li>
  <li>
    <p>Preserves the file paths in the local directory in the keys of replicated objects.</p>

    <p>For example, the file <code class="language-plaintext highlighter-rouge">/my-dir/my-project/file.text</code>, where <code class="language-plaintext highlighter-rouge">my-dir</code> is the directory on your Qumulo cluster, is uploaded to S3 as the following object, where <code class="language-plaintext highlighter-rouge">my-folder</code> is the specified S3 folder.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://my-bucket.s3.us-west-2.amazonaws.com/my-folder/my-project/file.txt
</code></pre></div>    </div>

    <div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note</b><br /> This process doesn’t encode or transform your data in any way. Shift-To replicates only the data in a regular file’s primary stream, excluding alternate data streams and file system metadata such as access control lists (ACLs). To avoid transferring data across the public Internet, a server-side S3 copy operation also copies any hard links to files in the replication local directory to S3 as full copies of objects, with identical contents and metadata.</div>

    <p>The following table explains how entities in the Qumulo file system map to entities in an S3 bucket.</p>

    <table>
      <thead>
        <tr>
          <th>Entity in the Qumulo File System</th>
          <th>Entity in an Amazon S3 Bucket</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Access control list (ACL)</td>
          <td>Not copied</td>
        </tr>
        <tr>
          <td>Alternate data streams</td>
          <td>Not copied</td>
        </tr>
        <tr>
          <td>Directory</td>
          <td>Not copied (directory structure is preserved in the object key for objects created for files)</td>
        </tr>
        <tr>
          <td>Hard link to a non-regular file</td>
          <td>Not copied</td>
        </tr>
        <tr>
          <td>Hard link to a regular file</td>
          <td>Copy of the S3 object</td>
        </tr>
        <tr>
          <td>Holes in sparse files</td>
          <td>Zeroes (holes are expanded)</td>
        </tr>
        <tr>
          <td>Regular file</td>
          <td>S3 object (the object key is the file system path and the metadata is the field data)</td>
        </tr>
        <tr>
          <td>SMB extended file attributes</td>
          <td>Not copied</td>
        </tr>
        <tr>
          <td>Symbolic link</td>
          <td>Not copied</td>
        </tr>
        <tr>
          <td>Timestamps (<code class="language-plaintext highlighter-rouge">mtime</code>, <code class="language-plaintext highlighter-rouge">ctime</code>, <code class="language-plaintext highlighter-rouge">atime</code>, <code class="language-plaintext highlighter-rouge">btime</code>)</td>
          <td>Not copied</td>
        </tr>
        <tr>
          <td>UNIX device file</td>
          <td>Not copied</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>Checks whether a file is already replicated. If the object exists in the remote S3 bucket, and neither the file nor the object are modified since the last successful replication, its data is not retransferred to S3.</p>

    <div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note</b><br /> Shift never deletes files in the remote S3 folder, even if the files are removed from the local directory since the last replication.</div>
  </li>
  <li>
    <p>Deletes the temporary snapshot.</p>
  </li>
</ol>

<h3 id="storing-and-reusing-relationships">Storing and Reusing Relationships</h3>
<p>The Shift-To relationship remains on the Qumulo cluster. You can monitor the completion status of a job, start new jobs for a relationship after the initial job finishes, and delete the relationship (when you no longer need the S3-folder-Qumulo-directory pair). To avoid redownloading objects that a previous copy job downloaded, relationships take up approximately 100 bytes per object. To free this storage, you can delete relationships that you no longer need.</p>

<p>If you repeatedly copy from the same Qumulo directory, you can speed up the download process (and skip already downloaded files) by using the same relationship.</p>

<p>A new relationship for subsequent downloads doesn’t share any tracking information with previous relationships associated with a directory and might recopy data that is already downloaded.</p>

<h2 id="using-the-qumulo-web-ui-to-copy-files-and-manage-relationships">Using the Qumulo Web UI to Copy Files and Manage Relationships</h2>
<p>This section describes how you can use the Qumulo Web UI 3.2.5 (and higher) to copy files from a Qumulo cluster to Amazon S3, review Shift relationship details, stop a running copy job, repeat a completed copy job, and delete a relationship.</p>

<h3 id="to-copy-files-to-amazon-s3">To Copy Files to Amazon S3</h3>
<ol>
  <li>Log in to Qumulo Core.</li>
  <li>Click <strong>Cluster &gt; Copy to/from S3</strong>.</li>
  <li>On the <strong>Copy to/from S3</strong> page, click <strong>Create Copy</strong>.</li>
  <li>
    <p>On the <strong>Create Copy to/from S3</strong> page, click <strong>Local ⇨ Remote</strong> and then enter the following:</p>

    <p>a. The <strong>Directory Path</strong> on your cluster (<code class="language-plaintext highlighter-rouge">/</code> by default)</p>

    <p>b. The S3 <strong>Bucket Name</strong></p>

    <p>c. The <strong>Folder</strong> in your S3 bucket</p>

    <p>d. The <strong>Region</strong> for your S3 bucket</p>

    <p>e. Your AWS <strong>Region</strong> (<code class="language-plaintext highlighter-rouge">/</code> by default)</p>

    <p>f. Your AWS <strong>Access Key ID</strong> and <strong>Secret Access Key</strong>.</p>
  </li>
  <li>(Optional) For additional configuration, click <strong>Advanced S3 Server Settings</strong>.</li>
  <li>Click <strong>Create Copy</strong>.</li>
  <li>
    <p>In the <strong>Create Copy to S3?</strong> dialog box, review the Shift relationship and then click <strong>Yes, Create</strong>.</p>

    <p>The copy job begins.</p>
  </li>
</ol>

<h3 id="to-view-configuration-details-and-status-of-shift-relationships">To View Configuration Details and Status of Shift Relationships</h3>

<ol>
  <li>Log in to Qumulo Core.</li>
  <li>
    <p>Click <strong>Cluster &gt; Copy to/from S3</strong>.</p>

    <p>The <strong>Copy to/from S3</strong> page lists all existing Shift relationships.</p>
  </li>
  <li>
    <p>To get more information about a specific Shift relationship, click <strong>⋮ &gt; View Details</strong>.</p>

    <figure><img class="docimage" src="images/administrator-guide/view-details-menu.png" alt="View Details Menu" /></figure>

    <p>The <strong>Copy to/from S3 Details</strong> page displays the following information:</p>

    <ul>
      <li><strong>Throughput:</strong> average</li>
      <li><strong>Run Time</strong></li>
      <li><strong>Data:</strong> total, transferred, and unchanged</li>
      <li><strong>Files:</strong> total, transferred, and unchanged</li>
    </ul>
  </li>
</ol>

<h3 id="to-stop-a-copy-job-in-progress">To Stop a Copy Job in Progress</h3>

<ol>
  <li>Log in to Qumulo Core.</li>
  <li>Click <strong>Cluster &gt; Copy to/from S3</strong>.</li>
  <li>
    <p>To stop a copy job for a specific relationship, click <strong>⋮ &gt; Abort</strong>.</p>

    <figure><img class="docimage" src="images/administrator-guide/abort-menu.png" alt="Abort Menu" /></figure>
  </li>
  <li>
    <p>In the <strong>Abort copy from?</strong> dialog box, review the Shift relationship and then click <strong>Yes, Abort</strong>.</p>

    <p>The copy job stops.</p>
  </li>
</ol>

<h3 id="to-repeat-a-completed-copy-job">To Repeat a Completed Copy Job</h3>

<ol>
  <li>Log in to Qumulo Core.</li>
  <li>Click <strong>Cluster &gt; Copy to/from S3</strong>.</li>
  <li>
    <p>To stop a copy job for a specific relationship, click <strong>⋮ &gt; Copy Again</strong>.</p>

    <figure><img class="docimage" src="images/administrator-guide/copy-again-menu.png" alt="Copy Again Menu" /></figure>
  </li>
  <li>
    <p>In the <strong>Copy again?</strong> dialog box, review the Shift relationship and then click <strong>Yes, Copy Again</strong>.</p>

    <p>The copy job repeats.</p>
  </li>
</ol>

<h3 id="to-delete-a-shift-relationship">To Delete a Shift Relationship</h3>

<ol>
  <li>Log in to Qumulo Core.</li>
  <li>Click <strong>Cluster &gt; Copy to/from S3</strong>.</li>
  <li>
    <p>To stop a copy job for a specific relationship, click <strong>⋮ &gt; Delete</strong>.</p>

    <figure><img class="docimage" src="images/administrator-guide/delete-menu.png" alt="Delete Menu" /></figure>
  </li>
  <li>
    <p>In the <strong>Delete copy from?</strong> dialog box, review the Shift relationship and then click <strong>Yes, Delete</strong>.</p>

    <p>The copy job is deleted.</p>
  </li>
</ol>

<h2 id="using-the-qumulo-cli-to-copy-files-and-manage-relationships">Using the Qumulo CLI to Copy Files and Manage Relationships</h2>
<p>This section describes how you can use the Qumulo CLI 3.2.5 (and higher) to copy files from a Qumulo cluster to Amazon S3, review Shift relationship details, stop a running copy job, repeat a completed copy job, and delete a relationship.</p>

<h3 id="copying-files-from-amazon-s3">Copying Files from Amazon S3</h3>
<p>To copy files, use the <code class="language-plaintext highlighter-rouge">replication_create_object_relationship</code> command and specify the following:</p>
<ul>
  <li>Local directory path on Qumulo cluster</li>
  <li>Copy direction (copy-to)</li>
  <li>S3 object folder</li>
  <li>S3 bucket</li>
  <li>AWS region</li>
  <li>AWS access key ID</li>
  <li>AWS secret access key</li>
</ul>

<p>The following example shows how you can create a relationship between the directory <code class="language-plaintext highlighter-rouge">/my-dir/</code> on a Qumulo cluster and the S3 bucket <code class="language-plaintext highlighter-rouge">my-bucket</code> and folder <code class="language-plaintext highlighter-rouge">/my-folder/</code> in the <code class="language-plaintext highlighter-rouge">us-west-2</code> AWS region. The secret access key is associated with the access key ID.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>qq replication_create_object_relationship <span class="se">\</span>
  <span class="nt">--source-directory-path</span> /my-dir/ <span class="se">\</span>
  <span class="nt">--direction</span> COPY_TO_OBJECT <span class="se">\</span>
  <span class="nt">--object-folder</span> /my-folder/ <span class="se">\</span>
  <span class="nt">--bucket</span> my-bucket <span class="se">\</span>
  <span class="nt">--region</span> us-west-2 <span class="se">\</span>
  <span class="nt">--access-key-id</span> AKIAIOSFODNN7EXAMPLE <span class="se">\</span>
  <span class="nt">--secret-access-key</span> wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
</code></pre></div></div>

<p>The CLI returns the details of the relationship in JSON format, for example:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"access_key_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ABC"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"bucket"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my-bucket"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"object_store_address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"s3.us-west-2.amazonaws.com"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1c23b4ed-5c67-8f90-1e23-a4f5f6ceff78"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"object_folder"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my-folder/"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">443</span><span class="p">,</span><span class="w">
  </span><span class="nl">"ca_certificate"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nl">"region"</span><span class="p">:</span><span class="w"> </span><span class="s2">"us-west-2"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"source_directory_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"direction"</span><span class="p">:</span><span class="w"> </span><span class="s2">"COPY_TO_OBJECT"</span><span class="p">,</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="viewing-configuration-details-and-status-of-shift-relationships">Viewing Configuration Details and Status of Shift Relationships</h3>
<ul>
  <li>
    <p>To view configuration details for all Shift relationships, use the <code class="language-plaintext highlighter-rouge">replication_list_object_relationships</code> command.</p>
  </li>
  <li>
    <p>To view configuration details for a specific relationship, use the <code class="language-plaintext highlighter-rouge">replication_get_object_relationship</code> command followed by the <code class="language-plaintext highlighter-rouge">--id</code> and the Shift relationship ID (GUID), for example:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> qq replication_get_object_relationship <span class="nt">--id</span> 1c23b4ed-5c67-8f90-1e23-a4f5f6ceff78
</code></pre></div>    </div>
  </li>
  <li>
    <p>To view the status of a specific relationship, use the <code class="language-plaintext highlighter-rouge">replication_get_object_relationship_status</code> command followed by the <code class="language-plaintext highlighter-rouge">--id</code> and the Shift relationship ID.</p>
  </li>
  <li>
    <p>To view the status of all relationships, use the <code class="language-plaintext highlighter-rouge">replication_list_object_relationship_statuses</code> command.</p>

    <p>The CLI returns the details of all relationships in JSON format, for example:</p>

    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"direction"</span><span class="p">:</span><span class="w"> </span><span class="s2">"COPY_TO_OBJECT"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"access_key_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AKIAIOSFODNN7EXAMPLE"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"bucket"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my-bucket"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"object_store_address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"s3.us-west-2.amazonaws.com"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1c23b4ed-5c67-8f90-1e23-a4f5f6ceff78"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"object_folder"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my-folder/"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">443</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ca_certificate"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"region"</span><span class="p">:</span><span class="w"> </span><span class="s2">"us-west-2"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"source_directory_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"source_directory_path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/my-dir/"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"REPLICATION_RUNNING"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"current_job"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"start_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-04-06T17:56:29.659309904Z"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"estimated_end_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-04-06T21:54:33.244095593Z"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"job_progress"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"bytes_transferred"</span><span class="p">:</span><span class="w"> </span><span class="s2">"178388608"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"bytes_unchanged"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"bytes_remaining"</span><span class="p">:</span><span class="w"> </span><span class="s2">"21660032"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"bytes_total"</span><span class="p">:</span><span class="w"> </span><span class="s2">"200048640"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"files_transferred"</span><span class="p">:</span><span class="w"> </span><span class="s2">"17"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"files_unchanged"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"files_remaining"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"files_total"</span><span class="p">:</span><span class="w"> </span><span class="s2">"21"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"percent_complete"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.890368314738253</span><span class="p">,</span><span class="w">
        </span><span class="nl">"throughput_current"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12330689"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"throughput_overall"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12330689"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"last_job"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>    </div>
    <p>The <code class="language-plaintext highlighter-rouge">state</code> field indicates a <code class="language-plaintext highlighter-rouge">REPLICATION_RUNNING</code> status and <code class="language-plaintext highlighter-rouge">current_job</code> shows ongoing progress. When Qumulo Core copies files from S3, details for the most recent completed job become available in the <code class="language-plaintext highlighter-rouge">last_job</code> field, the <code class="language-plaintext highlighter-rouge">state</code> field changes to <code class="language-plaintext highlighter-rouge">REPLICATION_NOT_RUNNING</code> and the <code class="language-plaintext highlighter-rouge">current_job</code> field reverts to <code class="language-plaintext highlighter-rouge">null</code>.</p>

    <div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note</b><br /> If you already ran a job for a relationship, it is possible for both the <code class="language-plaintext highlighter-rouge">current_job</code> and <code class="language-plaintext highlighter-rouge">last_job</code> fields to be non-null while you run a new job.</div>
  </li>
</ul>

<h3 id="stopping-a-copy-job-in-progress">Stopping a Copy Job in Progress</h3>
<p>To stop a copy job already in progress, use the <code class="language-plaintext highlighter-rouge">replication_abort_object_relationship</code> command followed by the <code class="language-plaintext highlighter-rouge">--id</code> and the Shift relationship ID.</p>

<h3 id="repeating-a-completed-copy-job">Repeating a Completed Copy Job</h3>
<p>To repeat a completed copy job, use the <code class="language-plaintext highlighter-rouge">replication_start_object_relationship</code> command followed by the <code class="language-plaintext highlighter-rouge">--id</code> and the Shift relationship ID.</p>

<p>This command begins a new job for the existing relationship and downloads any content that changed in the S3 bucket or on the Qumulo cluster since the time the previous job ran.</p>

<h3 id="deleting-a-shift-relationship">Deleting a Shift Relationship</h3>
<p>After your copy job is complete, you can delete your Shift relationship. To do this, run the <code class="language-plaintext highlighter-rouge">replication_delete_object_relationship</code> command followed by the <code class="language-plaintext highlighter-rouge">--id</code> and the Shift relationship ID.</p>

<div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note</b><br /> You can run this command only against a relationship that doesn’t have any active jobs running.</div>

<p>This command removes the copy job’s record, leaving locally stored objects unchanged. Any storage that the relationship used to track downloaded objects becomes available when you delete the relationship.</p>

<h2 id="troubleshooting-copy-job-issues">Troubleshooting Copy Job Issues</h2>
<p>Any fatal errors that occur during a copy job cause the job to fail, leaving a partially copied set of files in the directory in your S3 bucket.  However, to let you review the Shift relationship status any failure messages, the Shift relationship continues to exist. You can start a new job to complete the copying of objects to the S3 bucket—any successfully transferred files from the previous job aren’t retransferred from your Qumulo cluster.</p>

<p>Whenever Qumulo Core doesn’t complete an operation successfully and returns an error from the API or CLI, the <code class="language-plaintext highlighter-rouge">error</code> field within the <code class="language-plaintext highlighter-rouge">last_job</code> field (that the <code class="language-plaintext highlighter-rouge">replication_list_object_relationship_statuses</code> command returns) contains a detailed failure message. For more troubleshooting details, see <code class="language-plaintext highlighter-rouge">qumulo-replication.log</code> on your Qumulo cluster.</p>

<h2 id="best-practices">Best Practices</h2>
<p>We recommend the following best practices for working with Qumulo Shift-To for Amazon S3.</p>
<ul>
  <li><strong>Bucket Lifecycle Policy:</strong> To abort any incomplete uploads older than several days and ensure the automatic clean-up of any storage that incomplete parts of large objects (left by failed or interrupted replication operations) use, configure a bucket lifecycle policy. For more information, see <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/mpuoverview.html#mpu-abort-incomplete-mpu-lifecycle-config">Uploading and copying objects using multipart upload</a> in the <em>Amazon Simple Storage Service User Guide</em>.</li>
  <li><strong>VPC Endpoints:</strong> For best performance when using a Qumulo cluster in AWS, configure a <a href="https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints.html">VPC endpoint</a> to S3. For on-premises Qumulo clusters, we recommend <a href="https://docs.aws.amazon.com/whitepapers/latest/aws-vpc-connectivity-options/aws-direct-connect.html">AWS Direct Connect</a> or another high-bandwidth, low-latency connection to S3.</li>
  <li><strong>Unique Artifacts:</strong> To avoid collisions between different data sets, specify a unique object folder or unique bucket for each replication relationship from a Qumulo cluster to S3.</li>
  <li><strong>Object Versioning:</strong> To protect against unintended overwrites, enable object versioning. For more information, see <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/ObjectVersioning.html">Using versioning in S3 buckets</a> in the <em>Amazon Simple Storage Service User Guide</em>.</li>
  <li><strong>Completed Jobs:</strong> If you don’t plan to use a Shift relationship to download updates from S3, delete the relationship to free up any storage associated with it.</li>
  <li><strong>Concurrent Replication Relationships:</strong> To increase parallelism, especially across distinct datasets, use concurrent replication relationships to S3. To avoid having a large number of concurrent operations impact client I/O to the Qumulo cluster, limit the number of concurrent replication relationships. While there is no hard limit, we don’t recommend creating more than 100 concurrent replication relationships on a cluster (including both Shift and Qumulo local replication relationships).</li>
</ul>

<h2 id="restrictions">Restrictions</h2>
<ul>
  <li><strong>Object-Locked Buckets:</strong> You can’t use buckets configured with S3 Object Lock and a default retention period for Shift-To. If possible, either remove the defauly retention period and set retention periods explicitly on objects uploaded outside of Shift or use a different S3 bucket without S3 Object Lock enabled. For more information, see <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/object-lock-overview.html">How S3 Object Lock works</a> in the <em>Amazon Simple Storage Service User Guide</em>.</li>
  <li><strong>File Size Limit:</strong> The size of an individual file can’t exceed 5 TiB (this is the maximum object size that S3 supports). There is no limit on the total size of all your files.</li>
  <li><strong>File Path Limit:</strong> The length of a file path must be shorter than 1,024 characters, including the configured object folder prefix, excluding the local directory path.</li>
  <li><strong>Hard Links:</strong> Qumulo Core 3.2.3 (and higher) supports hard links, up to the maximum object size that S3 supports.</li>
  <li><strong>Objects Under the Same Key:</strong> Unless an object contains Qumulo-specific hash metadata that matches a file, any object that exists under the same key that a new relationship replicates <em>is overwritten</em>. To retain older versions of overwritten objects, enable versioning for your S3 bucket. For more information, see <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/ObjectVersioning.html">Using versioning in S3 buckets</a> in the <em>Amazon Simple Storage Service User Guide</em>.</li>
  <li><strong>Object Checksums:</strong> All files replicated using S3 server-side integrity verification (during upload) use a SHA256 checksum stored in the replicated object’s metadata.</li>
  <li><strong>S3-Compatible Object Stores:</strong> S3-compatible object stores aren’t supported. Currently, Qumulo Shift-To supports replication only to Amazon S3.</li>
  <li><strong>HTTP:</strong> HTTP isn’t supported. All Qumulo connections are encrypted using HTTPS and verify the S3 server’s SSL certificate.</li>
  <li><strong>Anonymous Access:</strong> Anonymous access isn’t supported. You must use valid AWS credentials.</li>
  <li><strong>Replication without Throttling:</strong> Replication provides no throttling and might use all available bandwidth. If necessary, use Quality of Service rules on your network.</li>
  <li><strong>Amazon S3 Standard Storage Class:</strong> Qumulo Shift-To supports uploading only objects stored in the Amazon S3 Standard storage class. You can’t download objects stored in the Amazon S3 Glacier or Deep Archive storage classes and any buckets that contain such objects cause a copy job to fail.</li>
  <li><strong>Content-Type Metadata:</strong> Because all objects are stored in S3 using the default <code class="language-plaintext highlighter-rouge">binary/octet-stream</code> content type, they might be interpreted as binary data if you download them using a browser. To attach content-type metadata to your objects, use the AWS Console.</li>
</ul>

</div>

    </div>

</div>    <!-- /.container -->

</body>

</html>
